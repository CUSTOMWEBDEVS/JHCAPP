<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
  <title>JHC HH Doc + Safety</title>
  <link rel="stylesheet" href="styles.css"/>
</head>
<body>
  <div id="bg"></div>

  <!-- AUTH / LANDING -->
  <div id="auth_overlay" class="overlay">
    <div class="auth-card">
      <div class="auth-brand">
        <div class="logo"></div>
        <div>
          <div class="auth-title">JHC HH Doc + Safety</div>
          <div class="auth-sub">Secure documentation • SOC checklist • calendar • safety</div>
        </div>
      </div>

      <div class="tabs">
        <button id="tab_login" class="tab active" type="button">Login</button>
        <button id="tab_signup" class="tab" type="button">Sign up</button>
      </div>

      <div id="login_panel" class="panel">
        <label>Email</label>
        <input id="login_email" type="email" autocomplete="username" placeholder="you@company.com"/>
        <label>Password</label>
        <input id="login_pass" type="password" autocomplete="current-password" placeholder="••••••••"/>
        <button id="btn_login" class="btn primary" type="button">Login</button>
      </div>

      <div id="signup_panel" class="panel hidden">
        <label>Email</label>
        <input id="signup_email" type="email" autocomplete="username" placeholder="you@company.com"/>
        <label>Password</label>
        <input id="signup_pass" type="password" autocomplete="new-password" placeholder="min 8 characters"/>
        <button id="btn_signup" class="btn primary" type="button">Create account</button>
        <div class="tiny dim">Your account starts as <b>clinician</b>. Supervisor/admin can change roles.</div>
      </div>

      <div id="auth_msg" class="msg"></div>
      <div class="tiny dim">If login fails: use “Forgot password” in Admin/Supervisor.</div>
    </div>
  </div>

  <!-- APP -->
  <div id="app" class="app hidden">
    <aside class="sidebar" id="sidebar">
      <div class="brand">
        <div class="brand-logo"></div>
        <div class="brand-text">
          <div class="brand-name">JHC</div>
          <div class="brand-sub">HH workflow</div>
        </div>
      </div>

      <div class="userbox">
        <div class="pill" id="me_email"></div>
        <div class="pill" id="me_role"></div>
      </div>

      <nav class="nav">
        <button class="navbtn active" data-view="visits" type="button">Visits & Notes</button>
        <button class="navbtn" data-view="patients" type="button">Patients</button>
        <button class="navbtn" data-view="calendar" type="button">Calendar</button>
        <button class="navbtn" data-view="admin" id="admin_nav" style="display:none;" type="button">Admin</button>
      </nav>

      <div class="spacer"></div>

      <button id="btn_logout" class="btn ghost full" type="button">Logout</button>
      <div class="tiny dim">Autosave after 900ms idle while typing.</div>
    </aside>

    <main class="main">
      <header class="topbar">
        <div class="top-left">
          <button id="btn_menu" class="btn icon" type="button" aria-label="Menu">☰</button>
          <div>
            <div class="h1">HH Workflow Dashboard</div>
            <div class="sub">Fast Sheets-backed documentation + safety</div>
          </div>
        </div>
        <div class="top-actions">
          <button id="btn_emergency" class="btn danger" type="button">Emergency</button>
          <button id="btn_refresh" class="btn" type="button">Refresh</button>
          <div class="pill" id="net_state">Idle</div>
        </div>
      </header>

      <!-- VISITS -->
      <section id="view_visits" class="view">
        <div class="grid2">
          <div class="card">
            <div class="cardhead">
              <div>
                <div class="cardtitle">Visits</div>
                <div class="cardsub">Open a visit → checklist + generator.</div>
              </div>
            </div>

            <div id="visits_list" class="list"></div>

            <div class="divider"></div>

            <div class="cardtitle">Create visit</div>
            <div class="formgrid">
              <div class="colspan">
                <label>Patient</label>
                <select id="create_patient"></select>
              </div>

              <div>
                <label>Visit type</label>
                <select id="create_type">
                  <option value="SOC" selected>SOC</option>
                  <option value="InitialEval">Initial Eval</option>
                  <option value="Revisit">Revisit</option>
                  <option value="Discharge">Discharge</option>
                </select>
              </div>

              <div>
                <label>Share address to team calendar</label>
                <select id="create_share">
                  <option value="Yes">Yes</option>
                  <option value="No" selected>No</option>
                </select>
              </div>

              <div>
                <label>Scheduled start</label>
                <input id="create_start" type="datetime-local"/>
              </div>

              <div>
                <label>Scheduled end</label>
                <input id="create_end" type="datetime-local"/>
              </div>

              <div class="colspan rowend">
                <button id="btn_create_visit" class="btn primary" type="button">Create</button>
              </div>
            </div>

            <div id="visit_msg" class="msg"></div>
          </div>

          <div class="card">
            <div class="cardhead">
              <div>
                <div class="cardtitle">Documentation</div>
                <div class="cardsub">Checklist drives exact template output.</div>
              </div>
              <div class="cardactions">
                <button id="btn_load" class="btn" type="button">Load</button>
                <button id="btn_save" class="btn" type="button">Save</button>
                <button id="btn_generate" class="btn primary" type="button">Generate</button>
                <button id="btn_sign" class="btn ghost" type="button">Sign & Lock</button>
              </div>
            </div>

            <div class="formgrid tight">
              <div class="colspan">
                <label>Active visit ID</label>
                <input id="active_visit" placeholder="Click a visit on the left"/>
              </div>
            </div>

            <div class="grid2 tight">
              <div>
                <div class="cardtitle sm" id="checklist_title">Checklist</div>
                <div id="soc_form" class="socbox"></div>
              </div>

              <div>
                <div class="cardtitle sm">Rendered Note</div>
                <pre id="rendered_note" class="note"></pre>
              </div>
            </div>

            <div class="divider"></div>

            <div class="cardtitle sm">Audio recording</div>
            <div class="recrow">
              <button id="rec_start" class="btn" type="button">Start</button>
              <button id="rec_stop" class="btn" type="button" disabled>Stop</button>
              <button id="rec_upload" class="btn primary" type="button" disabled>Upload</button>
              <select id="rec_retention">
                <option value="7">7d retention</option>
                <option value="30" selected>30d retention</option>
                <option value="90">90d retention</option>
              </select>
            </div>
            <div id="rec_status" class="tiny dim">Not recording.</div>
            <audio id="rec_playback" controls></audio>

            <div id="doc_msg" class="msg"></div>
          </div>
        </div>
      </section>

      <!-- PATIENTS -->
      <section id="view_patients" class="view hidden">
        <div class="card">
          <div class="cardhead">
            <div>
              <div class="cardtitle">Patients</div>
              <div class="cardsub">Add/update demographics. (Only visible to clinician+.)</div>
            </div>
          </div>

          <div class="formgrid">
            <div class="colspan">
              <label>Select</label>
              <select id="patient_select"></select>
            </div>

            <div class="colspan rowend">
              <button id="btn_new_patient" class="btn" type="button">New</button>
              <button id="btn_save_patient" class="btn primary" type="button">Save</button>
            </div>

            <div>
              <label>First</label>
              <input id="p_first"/>
            </div>
            <div>
              <label>Last</label>
              <input id="p_last"/>
            </div>
            <div>
              <label>DOB</label>
              <input id="p_dob" placeholder="YYYY-MM-DD"/>
            </div>
            <div>
              <label>Phone</label>
              <input id="p_phone"/>
            </div>
            <div class="colspan">
              <label>Address</label>
              <input id="p_address"/>
            </div>
            <div class="colspan">
              <label>Notes</label>
              <textarea id="p_notes" rows="3"></textarea>
            </div>
          </div>

          <div id="patient_msg" class="msg"></div>
        </div>
      </section>

      <!-- CALENDAR -->
      <section id="view_calendar" class="view hidden">
        <div class="card">
          <div class="cardhead">
            <div>
              <div class="cardtitle">Team Calendar</div>
              <div class="cardsub">Shared schedule + address (if chosen at visit creation).</div>
            </div>
            <div class="cardactions">
              <input id="cal_from" placeholder="from ISO (optional)"/>
              <input id="cal_to" placeholder="to ISO (optional)"/>
              <button id="btn_cal_load" class="btn" type="button">Load</button>
            </div>
          </div>
          <div id="calendar_list" class="list"></div>
        </div>
      </section>

      <!-- ADMIN -->
      <section id="view_admin" class="view hidden">
        <div class="card">
          <div class="cardhead">
            <div>
              <div class="cardtitle">Admin / Supervisor</div>
              <div class="cardsub">Manage users + roles + password resets. Prototype.</div>
            </div>
          </div>

          <div class="formgrid">
            <div class="colspan">
              <div class="tiny dim">
                Tip: Create your first admin by editing the USERS sheet row role → "admin", then login and use this panel.
              </div>
            </div>

            <div>
              <label>User email</label>
              <input id="admin_user_email" placeholder="user@company.com"/>
            </div>
            <div>
              <label>Role</label>
              <select id="admin_user_role">
                <option value="clinician">clinician</option>
                <option value="supervisor">supervisor</option>
                <option value="admin">admin</option>
              </select>
            </div>

            <div>
              <label>New password</label>
              <input id="admin_user_pass" type="password" placeholder="min 8 chars"/>
            </div>
            <div class="rowend">
              <button id="btn_admin_setpass" class="btn primary" type="button">Set password</button>
            </div>

            <div class="rowend colspan">
              <button id="btn_admin_setrole" class="btn" type="button">Set role</button>
              <button id="btn_admin_lookup_patient" class="btn" type="button">Lookup patient</button>
            </div>

            <div class="colspan">
              <pre id="admin_output" class="note" style="max-height:220px;"></pre>
            </div>
          </div>

          <div id="admin_msg" class="msg"></div>
        </div>
      </section>
    </main>
  </div>

  <script src="config.js"></script>
  <script src="app.js"></script>
</body>
</html>
