<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>HH Doc + Safety</title>
  <link rel="stylesheet" href="styles.css"/>
</head>
<body>
  <div class="bg"></div>

  <!-- AUTH / LANDING -->
  <section id="view_auth" class="shell">
    <div class="authCard">
      <div class="authBrand">
        <div class="logo"></div>
        <div>
          <div class="h1">HH Doc + Safety</div>
          <div class="sub">faster notes ‚Ä¢ safer visits</div>
        </div>
      </div>

      <div class="tabs">
        <button class="tab active" id="tab_login" onclick="uiShowAuth('login')">Login</button>
        <button class="tab" id="tab_signup" onclick="uiShowAuth('signup')">Sign up</button>
      </div>

      <div id="pane_login" class="pane">
        <label>Email</label>
        <input id="login_email" type="email" placeholder="you@agency.com">
        <label>Password</label>
        <input id="login_password" type="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
        <button class="btn primary w100" onclick="authLogin()">Login</button>
        <div class="muted" id="login_msg"></div>
      </div>

      <div id="pane_signup" class="pane" style="display:none">
        <label>Email</label>
        <input id="signup_email" type="email" placeholder="you@agency.com">
        <label>Password</label>
        <input id="signup_password" type="password" placeholder="min 8 chars">
        <button class="btn good w100" onclick="authSignup()">Create account</button>
        <div class="muted" id="signup_msg"></div>
        <div class="warn">
          Sign-ups may require supervisor activation depending on your settings.
        </div>
      </div>

  <!-- MAIN APP -->
  <section id="view_app" class="app" style="display:none">
    <aside class="sidebar">
      <div class="brand">
        <div class="logo"></div>
        <div>
          <div class="h1 small">HH Doc + Safety</div>
          <div class="sub">dashboard</div>
        </div>
      </div>

      <div class="pills">
        <span class="pill">User: <b id="me_email"></b></span>
        <span class="pill">Role: <b id="me_role"></b></span>
      </div>

      <nav class="nav">
        <button id="nav_patients" class="navBtn active" onclick="showTab('patients')">üë§ Patients</button>
        <button id="nav_visits" class="navBtn" onclick="showTab('visits')">üóìÔ∏è Visits</button>
        <button id="nav_doc" class="navBtn" onclick="showTab('doc')">üìù Documentation</button>
        <button id="nav_safety" class="navBtn" onclick="showTab('safety')">üõ°Ô∏è Safety</button>
        <button id="nav_calendar" class="navBtn" onclick="showTab('calendar')">üìå Calendar</button>
        <button id="nav_admin" class="navBtn" style="display:none" onclick="showTab('admin')">üß∞ Admin</button>
      </nav>

      <button class="btn w100" onclick="logout()">Logout</button>
      <div class="muted small">Autosave: after 1s idle while typing.</div>
    </aside>

    <main class="content">
      <div class="topbar">
        <div>
          <div class="h1">HH Workflow Dashboard</div>
          <div class="sub">Everything saves to Sheets via Apps Script API</div>
        </div>
        <div class="actions">
          <button class="btn" onclick="reloadAll()">Refresh</button>
          <span class="badge" id="statusBadge">Idle</span>
        </div>
      </div>

      <div class="grid">

        <!-- PATIENTS -->
        <section id="tab_patients" class="card">
          <div class="hd">
            <div>
              <div class="h2">Patients</div>
              <div class="sub">Create or update patient demographics</div>
            </div>
            <div class="row">
              <button class="btn primary" onclick="savePatient()">Save</button>
              <button class="btn" onclick="loadPatients()">Reload</button>
            </div>
          </div>
          <div class="bd split">
            <div>
              <label>Patient list</label>
              <select id="patient_select" onchange="selectPatient(this.value)"></select>
              <div id="patient_detail" class="muted" style="margin-top:10px"></div>
            </div>

            <div>
              <div class="row">
                <div class="col">
                  <label>First</label><input id="p_first" placeholder="First name">
                </div>
                <div class="col">
                  <label>Last</label><input id="p_last" placeholder="Last name">
                </div>
              </div>
              <div class="row">
                <div class="col">
                  <label>DOB</label><input id="p_dob" placeholder="YYYY-MM-DD">
                </div>
                <div class="col">
                  <label>Phone</label><input id="p_phone" placeholder="(xxx) xxx-xxxx">
                </div>
              </div>
              <label>Address</label><input id="p_address" placeholder="Street, City, State ZIP">
              <label>Notes</label><textarea id="p_notes" placeholder="Allergies, home access, caregiver notes..."></textarea>
              <div class="muted" id="patient_save_msg" style="margin-top:10px"></div>
            </div>
          </div>
        </section>

        <!-- VISITS -->
        <section id="tab_visits" class="card" style="display:none">
          <div class="hd">
            <div>
              <div class="h2">Visits</div>
              <div class="sub">Schedule + open visits</div>
            </div>
            <div class="row">
              <button class="btn primary" onclick="createVisit()">Create Visit</button>
              <button class="btn" onclick="loadVisits()">Reload</button>
            </div>
          </div>
          <div class="bd">
            <div class="row">
              <div class="col">
                <label>Visit type</label>
                <select id="visit_type">
                  <option value="SOC">SOC</option>
                  <option value="InitialEval">Initial Eval</option>
                </select>
              </div>
              <div class="col">
                <label>Scheduled start (ISO)</label>
                <input id="v_start" placeholder="2025-12-13T14:00">
              </div>
              <div class="col">
                <label>Scheduled end (ISO)</label>
                <input id="v_end" placeholder="2025-12-13T15:00">
              </div>
            </div>

            <div class="muted" id="visit_create_msg" style="margin-top:10px"></div>

            <div style="margin-top:14px" class="row">
              <div class="col">
                <label>Active visit</label>
                <input id="active_visit_id" placeholder="Visit ID (click Open on a visit below)">
              </div>
              <div style="flex:0 0 auto">
                <button class="btn good" onclick="openActiveVisit()">Open Active</button>
              </div>
            </div>

            <div style="margin-top:14px">
              <div class="h2">Recent visits</div>
              <div id="visits_list" class="list"></div>
            </div>
          </div>
        </section>

        <!-- DOC -->
        <section id="tab_doc" class="card" style="display:none">
          <div class="hd">
            <div>
              <div class="h2">Documentation</div>
              <div class="sub">Fast fields ‚Üí generate note ‚Üí sign & lock</div>
            </div>
            <div class="row">
              <button class="btn" onclick="loadVisitFields()">Load</button>
              <button class="btn primary" onclick="forceSaveFields()">Save</button>
              <button class="btn good" onclick="renderNote()">Generate</button>
              <button class="btn primary" onclick="signAndLock()">Sign & Lock</button>
            </div>
          </div>

          <div class="bd split">
            <div>
              <div class="h2">Fields</div>

              <label>Subjective</label>
              <textarea id="f_subjective" data-autosave="1"></textarea>

              <div class="row">
                <div class="col"><label>Homebound</label><input id="f_homebound" data-autosave="1"></div>
                <div class="col"><label>Referred by</label><input id="f_referred_by" data-autosave="1"></div>
              </div>

              <label>Living arrangements</label>
              <textarea id="f_living" data-autosave="1"></textarea>

              <div class="row">
                <div class="col"><label>History</label><textarea id="f_history" data-autosave="1"></textarea></div>
                <div class="col"><label>PLOF</label><textarea id="f_plof" data-autosave="1"></textarea></div>
              </div>

              <label>Falls</label>
              <textarea id="f_falls" data-autosave="1"></textarea>

              <div class="row">
                <div class="col"><label>Steps (Initial Eval)</label><input id="f_steps" data-autosave="1"></div>
                <div class="col"><label>Emergency plan (Initial Eval)</label><input id="f_emergency_plan" data-autosave="1"></div>
              </div>

              <div class="h2" style="margin-top:14px">Objective</div>
              <div class="row">
                <div class="col"><label>ROM</label><input id="f_rom" data-autosave="1"></div>
                <div class="col"><label>Strength</label><input id="f_strength" data-autosave="1"></div>
              </div>
              <div class="row">
                <div class="col"><label>Endurance</label><input id="f_endurance" data-autosave="1"></div>
                <div class="col"><label>Sensation</label><input id="f_sensation" data-autosave="1"></div>
              </div>
              <div class="row">
                <div class="col"><label>Transfers</label><input id="f_transfers" data-autosave="1"></div>
                <div class="col"><label>Gait</label><input id="f_gait" data-autosave="1"></div>
              </div>
              <div class="row">
                <div class="col"><label>Balance</label><input id="f_balance" data-autosave="1"></div>
                <div class="col"><label>Tinetti</label><input id="f_tinetti" data-autosave="1"></div>
              </div>

              <div class="h2" style="margin-top:14px">Skilled observation</div>
              <label>Vitals</label><textarea id="f_vitals" data-autosave="1"></textarea>
              <label>Disease mgmt</label><textarea id="f_disease_mgmt" data-autosave="1"></textarea>
              <label>Precautions</label><textarea id="f_precautions" data-autosave="1"></textarea>
              <label>Home safety</label><textarea id="f_home_safety" data-autosave="1"></textarea>
              <label>PHQ-2</label><textarea id="f_phq2" data-autosave="1"></textarea>

              <div class="h2" style="margin-top:14px">Interventions</div>
              <label>Gait training</label><textarea id="f_gait_training" data-autosave="1"></textarea>
              <label>Transfer training</label><textarea id="f_transfer_training" data-autosave="1"></textarea>
              <label>Ther Ex</label><textarea id="f_therex" data-autosave="1"></textarea>

              <div class="h2" style="margin-top:14px">Assessment</div>
              <label>Assessment summary</label><textarea id="f_assessment" data-autosave="1"></textarea>
              <label>Goal progress</label><textarea id="f_goal_progress" data-autosave="1"></textarea>

              <div class="muted" id="doc_msg" style="margin-top:10px"></div>
            </div>

            <div>
              <div class="h2">Rendered Note</div>
              <div class="sub">Generated from SOC / Initial Eval structure</div>
              <div class="pre" id="rendered_note" style="margin-top:10px"></div>
            </div>
          </div>
        </section>

        <!-- SAFETY -->
        <section id="tab_safety" class="card" style="display:none">
          <div class="hd">
            <div>
              <div class="h2">Safety</div>
              <div class="sub">Log emergency + prompt location</div>
            </div>
            <div class="row">
              <button class="btn danger" onclick="triggerEmergency()">üö® Emergency</button>
            </div>
          </div>
          <div class="bd">
            <div class="warn">
              This logs an incident to Sheets. Add your organization‚Äôs policy + consent process before any real deployment.
            </div>
          </div>
        </section>

        <!-- CALENDAR -->
        <section id="tab_calendar" class="card" style="display:none">
          <div class="hd">
            <div>
              <div class="h2">Calendar</div>
              <div class="sub">Address shown only to assigned clinician + supervisors</div>
            </div>
            <div class="row">
              <button class="btn" onclick="loadCalendar()">Load</button>
            </div>
          </div>
          <div class="bd">
            <div class="row">
              <div class="col"><label>From (ISO optional)</label><input id="cal_from"></div>
              <div class="col"><label>To (ISO optional)</label><input id="cal_to"></div>
            </div>
            <div id="calendar_list" class="list" style="margin-top:14px"></div>
          </div>
        </section>

        <!-- ADMIN -->
        <section id="tab_admin" class="card" style="display:none">
          <div class="hd">
            <div>
              <div class="h2">Admin</div>
              <div class="sub">Supervisors: manage users + search patients</div>
            </div>
            <div class="row">
              <button class="btn" onclick="adminLoadUsers()">Reload Users</button>
            </div>
          </div>
          <div class="bd split">
            <div>
              <div class="h2">Users</div>
              <div class="row">
                <div class="col"><label>Email</label><input id="admin_user_email" placeholder="user@agency.com"></div>
                <div class="col">
                  <label>Role</label>
                  <select id="admin_user_role">
                    <option value="clinician">clinician</option>
                    <option value="supervisor">supervisor</option>
                    <option value="admin">admin</option>
                  </select>
                </div>
                <div class="col">
                  <label>Active</label>
                  <select id="admin_user_active">
                    <option value="Y">Y</option>
                    <option value="N">N</option>
                  </select>
                </div>
              </div>
              <button class="btn primary w100" onclick="adminSaveUser()">Save User</button>
              <div id="admin_users_list" class="list" style="margin-top:14px"></div>
            </div>

            <div>
              <div class="h2">Patient lookup</div>
              <label>Search</label>
              <input id="admin_patient_q" placeholder="name, id, phone, address..." oninput="adminSearchPatientsDebounced()">
              <div id="admin_patients_list" class="list" style="margin-top:14px"></div>
            </div>
          </div>
        </section>

      </div>
    </main>
  </section>

  <div class="toast" id="toast"></div>

  <script src="app.js"></script>
</body>
</html>
